<!DOCTYPE html>
<html class="no-js" lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <th:block th:insert="fragments/layout :: head" th:with="pageTitle=${model.competitionTitle},hasFormErrors=${#fields.hasErrors('${form.*}')}" />
</head>

<body th:with="context='assessment'" class="assessor-comp-dashboard">
<th:block th:insert="fragments/modals :: modal-overlay" />
<th:block th:insert="fragments/layout :: body-start" />
<th:block th:insert="fragments/layout :: global-header" />

<main tabindex="-1" id="content">
    <th:block th:insert="fragments/layout :: main-content-start" />
    <th:block th:insert="fragments/assessment :: assessment-header-sub (linkTitle='Assessor dashboard',linkClass='link-back',linkUrl=@{/assessor/dashboard})" />

    <div th:if="${#fields.hasErrors('${form.*}')}" class="error-summary" role="alert" aria-labelledby="error-summary-heading" tabindex="-1">
        <h2 class="heading-medium error-summary-heading" id="error-summary-heading">There was a problem submitting some of your assessments.</h2>
        <ul class="error-summary-list">
            <li th:each="err : ${#fields.detailedErrors('${form.*}')}">
                <th:block th:if="${err.global}" th:text="${err.message}">Non-field specific message</th:block>
                <!--/* Add a one to the field name of assesmentId's as th:field will increament the id of the list and we just want to select the first one.
                       It was harder to make the template change underneath as it was inside of a loop with if/else */-->
                <a th:if="${err.fieldName}" th:href="|#${err.fieldName == 'assessmentIds' ? 'assessmentIds1' : err.fieldName}|" th:text="${err.message}">The error message</a>
            </li>
        </ul>
    </div>


    <th:block th:insert="fragments/layout :: page-title" th:with="pageTitle=${model.competitionTitle},size='heading-xlarge'" />

    <div class="grid-row">
        <div class="column-one-half competition details">
            <dl class="font-xsmall">
                <dt>Competition:</dt>
                <dd th:text="${model.competitionTitle}"></dd>
                <dt>Innovation Lead:</dt>
                <dd th:text="${model.leadTechnologist}"></dd>
                <dt>Panel date:</dt>
                <dd th:text="|${#strings.toLowerCase(#temporals.format(model.panelDate, 'hh:mma'))} ${#temporals.format(model.panelDate, 'EEEE d MMMM yyyy')}|"></dd>
            </dl>
        </div>

        <div class="column-one-half">
            <p><a th:href="@{~/competition/{cid}/overview(cid=${model.competitionId})}" target="_blank" rel="external noopener noreferrer">View competition brief (opens in a new window)</a></p>
        </div>
    </div>

    <div class="my-applications">
            <form method="post" th:object="${form}" th:action="@{${#ifsUtil.formPostUri(#httpServletRequest)}}">
                <div class="progress-list">
                    <h2 class="heading-medium no-margin">Applications for Panel (<span
                        th:text="${#lists.size(model.applications)}"/>)</h2>

                    <ul>

                        <li th:each="app,iterStat : ${model.applications}"
                            th:with="reviewUrl=@{/{reviewId}/review(reviewId=${app.reviewId})}"
                            th:class="${(app.pending ? 'status-2-col' : '')}">

                            <th:block>
                                <div class="task">
                                    <h3 class="heading-small"><a class="disabled" aria-disabled="true"
                                        th:text="${app.displayLabel}"/>
                                    </h3>
                                    <p th:text="${app.leadOrganisation}" class="no-margin"/>
                                </div>

                                <div class="status">

                                    <th:block th:if="${app.pending}">
                                        <div class="status-msg msg-deadline-waiting">
                                            Pending
                                        </div>
                                        <div class="status-msg msg-progress">
                                            <a class="disabled" aria-disabled="true">Accept or reject</a>
                                        </div>
                                    </th:block>

                                    <strong th:if="${app.accepted}" class="status-msg msg-progress">
                                        Accepted
                                    </strong>
                                </div>
                            </th:block>

                        </li>
                        <th:block th:if="${ #lists.isEmpty(model.applications) || model.afterPanelDate }">
                            <li class="status-2-col">
                                <div class="task">
                                    <h3 class="heading-small">No applications have been assigned to this panel.</h3>
                                </div>
                            </li>
                        </th:block>
                    </ul>
                </div>
            </form>
    </div>

    <p class="extra-margin form-hint">
        Please complete your review of the applications before the panel date. You cannot edit or add feedback to applications at this stage.
    </p>

    <th:block th:insert="fragments/layout :: main-content-end" />
</main>

<th:block th:insert="fragments/layout :: footer" />
<th:block th:insert="fragments/layout :: body-end" />
</body>
</html>
