<!DOCTYPE html>
<html class="no-js" lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
    <head>
        <th:block th:insert="fragments/layout :: head" th:with="pageTitle='Application team',hasFormErrors=${#fields.hasErrors('${form.*}')}" />
    </head>

    <body>
        <th:block th:insert="fragments/layout :: body-start" />
        <th:block th:insert="fragments/layout :: global-header" />

        <main tabindex="-1" id="content">
            <th:block th:insert="fragments/layout :: header-sub"
                      th:with="linkTitle='Application overview',linkClass='link-back',linkUrl=@{/application/{applicationId}(applicationId=${model.applicationId})}" />

            <div th:if="${#fields.hasErrors('${form.*}')}" class="error-summary" role="alert" aria-labelledby="error-summary-heading" tabindex="-1">
                <h2 class="heading-medium error-summary-heading"  id="error-summary-heading">There is a problem on this page.</h2>
                <th:block th:insert="fragments/elements :: error-summary-list(form)" />
            </div>

            <th:block th:with="applicationName=${#strings.isEmpty(model.applicationName)} ? #{ifs.application.no_title} : ${model.applicationName}">
              <th:block th:insert="fragments/layout :: page-title" th:with="pageTitle='Application team',subTitle=${applicationName},size='heading-xlarge'" />
            </th:block>

            <th:block th:fragment="page-body">

                <!-- Beginning -->
                <div th:unless="${model.closed or model.summary}" class="textarea-header">

                    <th:block th:if="${model.complete}">
                        <div class="success-alert assignee extra-margin-bottom">
                            <p>Application team is marked as complete</p>
                        </div>
                    </th:block>
                    <th:block th:if="${!model.complete}">
                        <p>View and manage your contributors or collaborators in the application.</p>

                        <p>The lead applicant cannot submit the application until everyone has accepted their invites. Only the lead can remove team members.</p>

                        <p>Read the guidance on <a href="https://www.gov.uk/guidance/innovate-uk-funding-general-guidance-for-applicants#applying-for-a-competition-on-the-innovation-funding-service" target="_blank">how collaboration in the Innovation Funding Service works</a> (this link will open in a new window).</p>

                        <div th:if="${model.applicationCanBegin}" class="message-alert">
                            <h2 class="heading-small">As the lead applicant you can:</h2>
                            <ul class="list-bullet">
                                <li>add collaborating and contributing organisations and individuals</li>
                                <li>manage organisations and individuals</li>
                                <li>assign questions to individuals</li>
                            </ul>
                        </div>
                    </th:block>
                </div>

                <!-- Middle -->
                <div class="form-group"
                     th:each="organisation : ${model.organisations}"
                     th:classappend="${#fields.hasErrors('${form.organisation*}')} ? 'form-group-error'">
                    <h2 class="heading-medium">
                        <th:block th:text="${organisation.name}">Organisation name</th:block>
                        <th:block th:if="${organisation.lead}"> (Lead)</th:block>
                        <th:block th:unless="${organisation.lead}"> (Collaborator)</th:block>
                    </h2>

                    <h3 class="heading-small">Organisation type</h3>
                    <p th:text="${organisation.type}">Research and technology organisations (RTOs)</p>

                    <th:block th:if="${#fields.hasErrors('${form.organisation*}')}">
                        <span class="error-message"
                              th:each="err : ${#fields.errors('${form.organisation*}')}"
                           th:text="${err}"></span>
                    </th:block>

                    <table class="table-overflow">
                        <thead>
                        <tr>
                            <th class="width-30-percent" scope="col">Applicant</th>
                            <th class="width-50-percent" scope="col">Email</th>
                            <th scope="col"><span class="visually-hidden">Additional details</span></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="applicant : ${organisation.applicants}">
                            <td th:text="${applicant.name}">Steve Smith</td>
                            <td th:text="${applicant.email}">steve.smith@empire.com</td>
                            <td th:text="${applicant.lead} ? 'Lead' : (${applicant.pending} ? 'Invite pending' : '')">Lead</td>
                        </tr>
                        </tbody>
                    </table>

                    <p th:if="${organisation.editable and !model.complete}">
                        <!--/* Prefer linking by the InviteOrganisation id over the Organisation id except where there is no InviteOrganisation. */-->
                        <a th:unless="${organisation.organisationExists}" th:href="@{/application/{applicationId}/team/update/invited/{organisationId}(applicationId=${model.applicationId}, organisationId=${organisation.inviteOrganisationId})}"
                           th:text="|Update and add contributors from ${organisation.name}|">Update and add contributors from Empire Ltd</a>
                        <a th:if="${organisation.organisationExists}" th:href="@{/application/{applicationId}/team/update/existing/{organisationId}(applicationId=${model.applicationId},organisationId=${organisation.organisationId})}"
                           th:text="|Update and add contributors from ${organisation.name}|">Update and add contributors from Empire Ltd</a>
                    </p>
                </div>

                <!-- End -->
                <th:block th:if="${model.userLeadApplicant and !model.complete}">
                    <p class="extra-margin">Add any organisations participating with you on this project. They are responsible for creating their own account and submitting their finances.</p>
                    <p><a th:href="@{/application/{applicationId}/team/addOrganisation(applicationId=${model.applicationId})}">Add a collaborator organisation</a></p>
                </th:block>
            </th:block>

            <p class="extra-margin">
                <a th:href="@{/application/{applicationId}(applicationId=${model.applicationId})}" class="button-secondary">
                    <th:block th:if="${model.applicationCanBegin}">
                        Begin application
                    </th:block>
                    <th:block th:unless="${model.applicationCanBegin}">
                        Return to application overview
                    </th:block>
                </a>
            </p>

            <th:block th:insert="fragments/layout :: main-content-end" />
        </main>

        <th:block th:insert="fragments/layout :: footer" />
        <th:block th:insert="fragments/layout :: body-end" />
        <th:block th:insert="fragments/service-layout :: body-end" />
    </body>
</html>
