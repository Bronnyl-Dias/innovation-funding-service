<!DOCTYPE html>
<html class="no-js" lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <th:block th:insert="fragments/layout :: head" th:with="pageTitle='Feedback overview'" />
</head>

<body class="app-summary" th:classappend="${applicationInterviewSummaryViewModel.application.isOpen() ? 'is-open' : 'is-closed' }">
<th:block th:insert="fragments/layout :: body-start" />
<th:block th:insert="fragments/layout :: global-header" />

<main tabindex="-1" id="content">
    <th:block th:insert="fragments/layout :: header-sub"
              th:with="linkTitle='Interviews you have agreed to attend',linkClass='link-back',linkUrl=@{~/assessment/assessor/dashboard/competition/{competitionId}/interview(competitionId=${applicationInterviewSummaryViewModel.competition.id})}"/>
    <th:block th:insert="fragments/elements :: competition-closing-warning (competition=${applicationInterviewSummaryViewModel.competition})" />
    <th:block th:with="applicationName=${#strings.isEmpty(applicationInterviewSummaryViewModel.application.name)} ? #{ifs.application.no_title} : ${applicationInterviewSummaryViewModel.application.name}">
        <th:block th:insert="fragments/layout :: page-title" th:with="pageTitle='Feedback overview',subTitle=${applicationInterviewSummaryViewModel.application.name},size='heading-xlarge'" />
    </th:block>

    <div class="grid-row">
        <div class="column-half">
            <h3 class="heading-small">Project title</h3>
            <p th:text="${applicationInterviewSummaryViewModel.application.name}">Machine learning in robots</p>

            <h3 class="heading-small">Application number</h3>
            <p th:text="${applicationInterviewSummaryViewModel.application.id}">Machine learning in robots</p>

            <h3 class="heading-small">Lead organisation</h3>
            <p th:text="${applicationInterviewSummaryViewModel.leadOrganisation.name}">Aptrans Ltd</p>

            <h3 class="heading-small">Partners</h3>
            <ul class="list">
                <li th:each="organisation : ${applicationInterviewSummaryViewModel.partners}" th:unless="${organisation.equals(applicationInterviewSummaryViewModel.leadOrganisation)}" th:text="${organisation.name}">Biotech Corp</li>
            </ul>
        </div>

        <div class="column-half">
            <h3 class="heading-small">Project timescales</h3>
            <p>Project start date: <br />
                <th:block
                    th:if="${applicationInterviewSummaryViewModel.application.startDate}"
                    th:text="${#temporals.format(applicationInterviewSummaryViewModel.application.startDate, 'd MMMM yyyy')}" />
            </p>
            <p>Duration: <br /><th:block th:text="${applicationInterviewSummaryViewModel.application.durationInMonths}" /> months</p>

            <h3 class="heading-small extra-margin">Total project cost</h3>
            <p>&pound;<th:block th:text="${applicationInterviewSummaryViewModel.totalFundingSought} ? ${#numbers.formatInteger(applicationInterviewSummaryViewModel.totalFundingSought, 0, 'DEFAULT')} : '0'">203,567</th:block></p>
        </div>
    </div>

    <div class="message-alert">
        <p th:text="${applicationInterviewSummaryViewModel.bannerText}">Some info</p>
    </div>

    <th:block th:if="${applicationInterviewSummaryViewModel.hasResponse() || applicationInterviewSummaryViewModel.hasFeedback()}">
        <h2 class="heading-medium">Attachments</h2>
        <div class="form-group download" th:if="${applicationInterviewSummaryViewModel.hasResponse()}">
            <h3 class="heading-small no-margin">
                Applicant feedback response
            </h3>
            <a th:href="@{/application/{applicationId}/summary/download-response(applicationId=${applicationInterviewSummaryViewModel.application.id})}"
               th:text="${applicationInterviewSummaryViewModel.responseFilename + ' (opens in a new window)'}"
               target="_blank">File</a>
        </div>

        <div class="form-group download" th:if="${applicationInterviewSummaryViewModel.hasFeedback()}">
            <h3 class="heading-small no-margin">
                Panel assessment feedback
            </h3>
            <a th:href="@{/application/{applicationId}/summary/download-feedback(applicationId=${applicationInterviewSummaryViewModel.application..id})}"
               th:text="${applicationInterviewSummaryViewModel.feedbackFilename + ' (opens in a new window)'}"
               target="_blank">File</a>
        </div>
    </th:block>

    <h2 class="heading-medium no-margin-bottom">Assessor feedback</h2>
    <p class="form-hint">Assessors do not provide scores on these sections of the application.</p>

    <section th:each="section : ${applicationInterviewSummaryViewModel.sections.values()}" th:unless="${section.name.equals('Finances')}">
        <th:block th:if="${section.name.equals('Project details')}">
            <ul class="list-overview">
                <th:block th:each="question : ${applicationInterviewSummaryViewModel.sectionQuestions.get(section.id)}" th:unless="${question.questionSetupType == T(org.innovateuk.ifs.competition.resource.CompetitionSetupQuestionType).APPLICATION_DETAILS}">
                    <li class="section-status grid-row">
                        <div class="column-two-thirds">
                            <h3 class="heading-small">
                                <a th:href="@{/application/{apId}/question/{qId}/feedback(apId=${applicationInterviewSummaryViewModel.application.id},qId=${question.id})}"
                                   th:text="${question.shortName}" >Project summary</a>
                            </h3>
                        </div>
                        <div class="column-third">
                            <p class="form-hint no-margin">No feedback provided</p>
                        </div>
                    </li>
                </th:block>
            </ul>
        </th:block>
        <th:block th:if="${!section.name.equals('Project details')}">
            <h2 class="heading-medium no-margin-bottom">Assessor feedback</h2>
            <p class="form-hint">Each question has been assessed by several independent assessors. They have given a score and feedback for each.</p>

            <ul class="list-overview">
                <li class="section-status grid-row" th:each="question : ${applicationInterviewSummaryViewModel.sectionQuestions.get(section.id)}">
                    <div class="column-two-thirds">
                        <h3 class="heading-small">
                            <a th:href="@{/application/{apId}/question/{qId}/feedback(apId=${applicationInterviewSummaryViewModel.application.id},qId=${question.id})}"
                               th:text="${question.questionNumber!=null ? question.questionNumber + '. ' : '' } + ${question.shortName}">1. Business opportunity</a>
                        </h3>
                    </div>
                    <div>
                        <div class="column-third" th:text="|Average score ${applicationInterviewSummaryViewModel.scores.scores.get(question.id)} / ${question.assessorMaximumScore}|">Average score 7 / 10</div>
                    </div>
                </li>
            </ul>
            <div class="grid-row extra-margin">
                <div class="column-two-thirds">
                    &nbsp;
                </div>
                <div class="column-third">
                    <p>Average overall: <strong class="heading-" th:text="|${applicationInterviewSummaryViewModel.scores.averagePercentage}%|">70%</strong></p>
                </div>
            </div>
        </th:block>
    </section>

    <section th:if="${applicationInterviewSummaryViewModel.hasFinanceSection}">
        <h2 class="heading-medium">Finance</h2>
        <div class="collapsible">
            <h3>Finances summary</h3>
            <div class="question">
                <div th:replace="finance/finance-summary :: application_finances_summary (isApplicant = true,
                                                                                          form.isAdminMode() = false,
                                                                                          currentApplication = ${applicationInterviewSummaryViewModel.applicationFinanceSummaryViewModel.currentApplication},
                                                                                          hasFinanceSection = ${applicationInterviewSummaryViewModel.applicationFinanceSummaryViewModel.hasFinanceSection},
                                                                                          financeTotalPerType = ${applicationInterviewSummaryViewModel.applicationFinanceSummaryViewModel.financeTotalPerType},
                                                                                          applicationOrganisations = ${applicationInterviewSummaryViewModel.applicationFinanceSummaryViewModel.applicationOrganisations},
                                                                                          leadOrganisation = ${applicationInterviewSummaryViewModel.applicationFinanceSummaryViewModel.leadOrganisation},
                                                                                          userOrganisation = ${applicationInterviewSummaryViewModel.applicationFinanceSummaryViewModel.leadOrganisation},
                                                                                          sectionsMarkedAsComplete = ${applicationInterviewSummaryViewModel.applicationFinanceSummaryViewModel.sectionsMarkedAsComplete})
"></div>
                <h2 class="heading-medium">Funding breakdown</h2>
                <th:block th:insert="finance/finance-summary :: financial_summary_table" />
            </div>
        </div>
    </section>

    <div th:if="!${#lists.isEmpty(applicationInterviewSummaryViewModel.feedback)}">
        <h2 class="heading-medium">Assessor feedback</h2>
        <ul class="boxed-list">
            <li th:each="item, iterStat : ${applicationInterviewSummaryViewModel.feedback}">
                <h3 class="heading-small" th:text="|Assessor ${iterStat.count}|">Assessor 1</h3>
                <div th:text="${item}" data-text-to-html="" class="wysiwyg-styles">Feedback text</div>
            </li>
        </ul>
    </div>

    <th:block th:insert="fragments/layout :: main-content-end" />
</main>

<th:block th:insert="fragments/layout :: footer" />
<th:block th:insert="fragments/layout :: body-end" />
<th:block th:insert="fragments/service-layout :: body-end" />
</body>
</html>
