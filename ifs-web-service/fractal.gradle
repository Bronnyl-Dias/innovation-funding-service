import com.bmuschko.gradle.docker.tasks.image.*

buildscript {


    repositories {
        jcenter()
    }

    dependencies {
        classpath "com.bmuschko:gradle-docker-plugin:3.2.4"
    }

}


repositories {
    mavenCentral()
}

// use fully qualified class name
apply plugin: com.bmuschko.gradle.docker.DockerRemoteApiPlugin


    task prepareFractalDockerInput {

        def inputDir = project.file("$project.buildDir/fractal")
        inputDir.delete();

        doFirst {
            copy {
                from file("ifs-web-core/src/main/resources/templates/fractal-components")
                into file("${inputDir}/fractal-components")
            }
            copy {
                from file("ifs-web-core/src/main/resources/static")
                into file("${inputDir}/static")
            }
            copy {
                from file("fractal.js")
                into inputDir
            }
            copy {
                from file("fractal")
                into inputDir
            }
        }
    }

    task buildFractal(type: DockerBuildImage) {
        dependsOn prepareFractalDockerInput
        tag = "innovateuk/fractal:latest"
        inputDir = project.file("$project.buildDir/fractal")
    }


