import com.bmuschko.gradle.docker.tasks.image.DockerBuildImage
import com.bmuschko.gradle.docker.tasks.image.DockerPushImage
import com.bmuschko.gradle.docker.tasks.image.DockerTagImage

def sqlVersion="5.6.29"

task buildDocker(overwrite: true, type: DockerBuildImage) {
    tag = "innovateuk/ifs-mysql:"+sqlVersion
    inputDir = project.projectDir
}

task buildDockerForOS(overwrite: true, type: DockerBuildImage) {
    onlyIf { !isNamedEnv() }

    tag = project.dockerRegistry + "/" + openshiftEnv + "/"+sqlVersion
    inputDir = project.projectDir
}

task tagDocker(type: DockerTagImage) {
    onlyIf { !isNamedEnv() }

    dependsOn buildDockerForOS
    imageId = buildDockerForOS.getTag()
    repository = project.dockerRegistry + "/" + openshiftEnv + "/ifs-mysql"
    tag = sqlVersion
}

task osStageRemote(type: DockerPushImage) {
    onlyIf { !isNamedEnv() }

    dependsOn tagDocker
    registryCredentials = project.ext.dockerRegistryCredentials
    imageName = project.dockerRegistry + "/" + openshiftEnv + "/ifs-mysql"
    tag = sqlVersion
}

task tagDockerLocal(type: DockerTagImage) {
    dependsOn buildDockerForOS
    imageId = buildDockerForOS.getTag()
    repository = localDockerRegistryCredentials.url + "/" + openshiftEnv + "/ifs-mysql"
    tag = sqlVersion
}

task osStageLocal(type: DockerPushImage) {
    dependsOn tagDockerLocal
    registryCredentials = project.ext.localDockerRegistryCredentials
    imageName=localDockerRegistryCredentials.url + "/" + openshiftEnv + "/ifs-mysql"
    tag = sqlVersion
}



